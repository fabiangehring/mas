# Einleitung {#intro}

## Motivation
Aktienoptionen sind derivative Finanzinstrumente, welche dem Inhaber das Recht (nicht aber die Pflicht) geben, die zugrunde liegende Aktie (auch Basiswert oder Underlying) zu einem im Voraus festgelegten Ausübungspreis (auch Strike) zu kaufen oder zu verkaufen. Wie sich der Preis einer Option entwickelt, ist dabei von verschiedenen Faktoren abhängig. Dazu gehören unter anderem der Preis des Basiswertes, dessen Volatilität oder die Restlaufzeit der Option.

Der Zusammenhang zwischen Preis des Underlyings und Preis der Option ist nicht linear, sondern nimmt bei steigendem Preis zu (Kaufoption), resp. ab (Verkaufsoption). Diese nicht-Linearität wird mit Hilfe der Kennzahl Gamma ($\Gamma$) beschrieben. Im profesionellen Optionenhandel ist es üblich, den linearen Teil der Veränderung (Delta, auch $\Delta$) durch Kauf oder Verkauf des Underlyings abzusichern. Damit lassen sich Strategien verfolgen, welche von der Richtung der Preisbewegung unabhängig sind (Delta-Neutral Trading). Der Nicht-lineare Zusammenhang führt allerdings dazu, dass die Delta-Neutralität mit sich ändernden Preisen wieder verloren geht. Dies sei nachfolgend an einem Beispiel demonstriert:


Sei dazu angenommen, dass eine Aktie zum Preis von 10 gehandelt wird. Die Aktie dient als Basiswert sowohl für eine Kaufoption (Call) wie auch eine Verkaufsoption (Put). Die Laufzeit beträgt 6 Monate, der Strike ebenfalls 10. Mit dem Kauf der Option erwirbt der Besitzer damit das Recht, die Aktie in 6 Monaten zu 10 zu kaufen (im Falle des Calls) oder zu verkaufen (im Falle des Puts). In diesem Beispiel entspricht der Aktienkurs dem Strike. Solche Optionen bezeichnet man als "at-the-money (atm)". Bei Veränderung des Basispreises werden diese zu "in-the-money (itm)" oder "out-of-the-money (otm)" Optionen.


``` {r, setup_intro, echo=FALSE, message=FALSE, warning=FALSE}
suppressPackageStartupMessages({
  source("R/01-intro.R")
})
```

```{r call-put, fig.cap='Zusammenhang zwischen Preis der Underlyings und Preis der Option.', fig.asp=0.6, fig.pos = '!H', echo=FALSE, warning=FALSE, message=FALSE}
t <- 0
S <- seq(5, 15, 0.01)
r <- 0.01
sigma = 0.5
K = 10
T = 0.5
move = 0.2

delta_atm_call <- qrmtools::Black_Scholes(t, K, r, sigma, K, T, "call")
delta_atm_put <- qrmtools::Black_Scholes(t, K, r, sigma, K, T, "put")

par(mfrow = c(1, 2))
plot_call_price(t, S, r, sigma, K, T, move, "call")
plot_call_price(t, S, r, sigma, K, T, move, "put")
par(mfrow = c(1, 1))
```

Den Zusammenhang zwischen Preis der Option und Preis des Underlyings ist in Abbildung \@ref(fig:call-put) abgebildet. Die gestrichelten Linien bilden die Tangenten beim Strikepreis der Optionen. Deren Steigungen ($\Delta$) betragen `r round(delta_atm_call, 2)`im Falle des Calls, und `r round(-delta_atm_put, 2)` im Falle des Puts. Dies bedeutet, dass sich der Besitzer der Option sich gegen Preisbewegungen absichern (hegden) kann, indem er zusätzlich zum Besitz der Option diese Anzahl an Aktien verkauft (Call), resp. kauft (Put). Wertänderungen der Option werden dann durch die entgegenläufige Wertenwicklung in der Aktienposition ausgeglichen. Eine solche gegenüber Preisänderungen nicht sensitive Position wird "deltaneutral" genannt. Bei grösseren Preisbewegungen führt die Konvexität des Optionspreises allerdings dazu, dass es trotz Absicherung zu einer Abweichung kommt. Diese "Fehler" sind in Abbildung \@ref(fig:call-put) mit roten Linien dargestellt. Es mag auf den ersten Blick erstaunen, dass diese Abweichung immer zugunsten des Optionsbesitzers ausfällt (sowohl für Call- als auch Put-Option verlaufen die Tangenten unterhalb des Optionspreises). Dass es sich dabei aber nicht eine Geldmaschine handelt liegt daran, dass die beschriebenen Preisbewegungen erst im Laufe der Zeit erfolgen und die Restlaufzeit der Option kleiner wird (Theta, auch $\Theta$). Mit sinkender Restlaufzeit nimmt auch der Wert der Option ab. In effizienten Märkten gleichen sich diese Effekte im Durchschnitt aus.

Wenn die zukünftigen Bewegungen des Preises grösser sind, als dies durch den Markt mit dem Wertverlust aufgrund der Zeit einpreist, kann die Verfolgung einer solchen Handelsstrategie allerdings lukrativ sein. Die Schwierigkeit liegt hier natürlich bei der Auswahl der richtigen Titel. Diese Strategie wird als Gamma-Scalping bezeichnet.

Der Einfluss des Gammas ist aber nicht nur zu Spekulationszwecken interessant. Dessen Bewirtschaftung ist auch für die Steuerung des eingegangenen Risikos von Relevanz. Soll nämlich die Delta-Neutralität nach Preisbewegungen wieder hergestellt werden, müssen laufend neue Titel des Underlyings gekauft oder verkauft werden. Grafisch entspricht dies der Einnahme einer Aktienposition, welche wieder der Steigung der Tangente beim nun vorherrschenden Preis entspricht. Typischerweise ist es so, dass diese Anpassungen abends (zur Reduktion des Risikos über Nacht) oder je nach Entscheidung des Händlers auch untertags erfolgen. Der Händler wird dabei versuchen, den Ausgleich nach möglichst grosser Preisbewegung zu machen, d.h. negatives Delta am Tiefstpunkt zu kaufen resp. positives Delta am Höchstpunkt zu verkaufen. Verpasst er diesen Zeitpunkt und die Preise entwickeln sich wieder Richtung Ausgangspunkt, so entgehen ihm mögliche Gewinne.


## Forschungsfrage
Für die vorliegende Arbeit ergibt sich damit folgende Forschungsfrage:

Kann mit Hilfe datengestützter Methoden eine Strategie gefunden werden, welche einen OPtionshändler unterstützt, die idealen (intraday) Preise zum Kauf / Verkauf von aufgelaufenem Delta zu finden? 

Als Vergleich bietet sich dabei eine Strategie an, welche keine intraday Anpassungen vornimmt, sondern die aufgelaufene Delta-Position erst am Abend ausgleicht. Die Voraussage jeweils eines Verkaufs- und eines Kaufpreises soll dabei bei Markteröffnung des jeweiligen Tages erfolgen. Bei Tagesende noch vorhandenes Delta (aufgrund nicht erreichter Kaufs- oder Verkaufspreise oder neu aufgelaufenes Delta bis Tagesende) wird immer zum Tagesschlusskurs ausgeglichen.

Mathematisch lassen sich beide Strategien mit Hilfe einer Payoff-Funktion ausdrücken.

Für die einfachere Referenzstrategie, welche die Delta-Neutraliät erst bei Tagesende wieder herstellt, lautet diese wie folgt:

\begin{equation}
\begin{aligned}
Payoff ={} & \frac{1}{2}  \times 100 \times \$\Gamma_{close_{t-1}}  \times \ln{\left(\frac{close_t}{close_{t-1}}\right)}^2
\end{aligned}
\end{equation}

Für die Notation werden log-Returns verwendet. Diskrete Returns sind aber genauso möglich. Als $close_i$ wird der Tagesendkurs am Tag $i$ bezeichnet. Unter  $\$\Gamma_i$ verstehen wir dabei das Gamma Cash (auch Dollar Cash). Die Herleitung dieses Payoffs ergibt sich aufgrund folgender Überlegungen [vgl. @sp_finance]:

Bezeichne $S_0$ den Preis des Underlyings und $P_0$ den Preis der Option zu Beginn und $S_1$ sowie $P_1$ die jeweiligen Preise nach einer Preisbewegung des Underlyings um $d_S$. $\Delta_0$ und $\Gamma_0$ bezeichnen die erste und zweite Ableitung des Optionspreises nach dem Underlyingpreis zum Ausgangszeitpunkt. Ferner sei als Delta Cash ($\$\Delta = \Delta \times S$) der Wert des Hedge Portfolio bezeichnet und Gamma Cash ($\$\Gamma = \Gamma \times S^2/100$) bezeichne die Veränderung des $\$\Delta$ bei einer 1-prozentigen Veränderung des Underlying-Preises. Dies lässt sich wie folgt herleiten: Verändert sich der Underlying-Preis um 1% $S => S + S / 100$, verändert sich auch das Delta $\Delta => \Delta + \Gamma \times S/100$. Das neue Delta Cash verändert sich damit in der Höhe von Gamma Cash $\$\Delta => \$\Delta + \Gamma \times S^2/100$.

Mit Hilfe dieser Notation lässt sich der Gewinn einer zu Beginn delta-gehedgten Position herleiten: 

1. Veränderung des Underlying Preises $S_1 = S_0 + dS$
1. Veränderung des Deltas $\Delta_1 = \Delta_0 + \Gamma_0 \times dS$
1. Durchschnittliches Deltas $\Delta_{Avg} = (\Delta_0 + \Delta_1) / 2 = \Delta_0 + \Gamma_0 \times dS / 2$
1. Neuer Optionspreis $P_1 = P_0 + \Delta_{Avg} \times dS = P_0 + \Delta_0 \times dS + \Gamma_0 \times dS² / 2$ 
1. Gewinn als Summe der Veränderungen des Optionspreis und des Hedge-Portfolios: $\Delta_0 \times dS + \Gamma_0 \times dS^2 / 2 - \Delta_0 \times dS = \Gamma_0 \times dS^2 / 2$
1. Etwas umgeformt lässt sich der Gewinn schreiben als: $\Gamma_0 \times dS^2 / 2 = \Gamma_0 \times S^2 /100 \times dS^2 / S^2 \times 100 = \$\Gamma \times (dS/S)^2 \times 100$ 


Auch im Falle der etwas komplexeren Strategie mit der Möglichkeit von Käufen und Verkäufen innerhalb des Tages lässt sich die gleiche Payoffstruktur wiederfinden:

\begin{eqnarray}
{Payoff} & = & \frac{1}{2} \times 100 \times \$\Gamma_{close_{t-1}} \times \ln{\left(\frac{first}{close_{t-1}}\right)}^2  \times I_{first} \times (1 - I_{second}) \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{first} \times \ln{\left(\frac{close_t}{first}\right)}^2  \times I_{first} \times (1 - I_{second}) \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{close_{t-1}} \times \ln{\left(\frac{second}{close_{t-1}}\right)}^2  \times I_{second} \times (1 - I_{first}) \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{second} \times \ln{\left(\frac{close_t}{second}\right)}^2  \times I_{second} \times (1 - I_{first}) \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{close_{t-1}} \times \ln{\left(\frac{first}{close_{t-1}}\right)}^2  \times I_{second} \times I_{first} \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{first} \times \ln{\left(\frac{second}{first}\right)}^2  \times I_{first} \times I_{second} \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{second} \times \ln{\left(\frac{close_t}{second}\right)}^2  \times I_{second} \times I_{first} \ +\\
&  & \frac{1}{2} \times 100 \times \$\Gamma_{close_{t-1}} \times \ln{\left(\frac{close_t}{close_{t_1}}\right)}^2  \times (1 - I_{first}) \times (1 - I_{second})
\end{eqnarray}

wobei, 

\begin{equation}
\$\Gamma_i = \Gamma \times S_i^2 / 100
\end{equation}

Zu beachten gilt es insbesondere, dass der Payoff quadratisch auf Preisbewegungen reagiert. Dies führt dazu, dass es von Relevanz ist, ob zuerst der Kaufs- (untere Grenze) oder der Verkaufsschwelle erreicht wird. Die Ausführung zum jeweiligen Schwellenwert wird durch die Indikatorvariablen $I_{first}$ und $I_{second}$ modelliert. Damit es zu einer Ausfühung kommt müssen dabei folgende beiden Kriterien kumulativ erfüllt sein:

a) Der Schwellenwert wird erreicht.
b) Die vorangegangene Transaktion hat bei einem höheren Preis für Aktion an unterer Schwelle, resp. tieferen Preis für eine Aktion an der oberen Schwelle stattgefunden.

<!-- Können die Verteilungen des Kurses im Laufe des Tages prognostiziert werden, so könnten diejenigen Kauf- und Verkaufpreise gewählt werden, welche unter Berücksichtigung dessen Eintretenswahrscheinlichkeit die höchsten Gewinne ermöglicht. Dies soll in der vorliegenden Arbeit mit Hilfe von Machine Learning Algorithmen untersucht werden. -->


## Daten
Als Datengrundlage stehen historische Open-, Low-, High- und Close- (adjustiert wie unadjustiert) Aktienpreise zur Verfügung. Diese sind öffentlich und können von Yahoo Finance bezogen werden. So kommen 9.5 Mio. historische Datenpunkte für die grössten rund 1600 Unternehmen weltweit zusammen Die Datenqualität scheint grundsätzlich ok. Gewisse Datenbereinigungsschritte sind aber nötig. 

Die Verwendung öffentlicher Daten hat den Vorteil, dass diese problemlos auf Cloud-Infrastruktur (bsp. unabdingbar im Falle des Einsatzes von Neuronalen Netzen / Deep Learning Techniken) prozessiert werden können, ohne dabei Lizenzvereinbarungen berücksichtigen zu müssen. 

## Methoden
Es werden verschiedene Methoden versucht und gegeneinander verglichen. Diese sind: 

- Einfach Optimierungen
- Nearest Neighbor Ansätze
- Neuronale Netzwerke

<!-- Anbei aber eine Sammlung von denkbaren Ansätzen: -->

<!-- * Clusteranalysen mit Hilfe diverser Disanzmasse (Manhattan Distance, Cosine Similarity): Lassen sich um den aktuellen Kursverlauf in Verbindung zur Vergangenheit (des aktuellen oder anderer Titel) bringen und darüber allfällige Rückschlüsse auf die Zukunft zu machen. -->
<!-- * k-means: Lassen sich in der Historie ähnliche / sich wiederholende Patterns von Kursverläufen / -verteilungen finden, welche Rückschlüsse auf die Zukunft ermöglichen? -->
<!-- * Welche Aussagen können "klassische" autoregressive statistische Modelle (G)ARCH machen? -->
<!-- * Können Neuronale Netze (z.B. LSTM) chartistische Muster erkennen? -->
<!-- * Deep Learing Methoden: Können anhand visualisierter Kursverläufe / -verteilungen Muster erkennen/gelernt werden? -->
<!-- * Weitere zusammen mit dem Betreuer festgelegte Methoden -->


## Disclaimer
Etliche Untersuchungen haben sich bereits damit beschäftigt, kursrelevante Informationen vorauszusagen. Viele der dabei gefundenen Erkenntnisse sind nicht oder nur unter speziellen Voraussetzungen anwendbar. Es sei deshalb an dieser Stelle erwähnt, dass sich dem sowohl der Autor als auch dessen Auftraggeber bewusst ist. Auch wenn diese ausbleiben bietet diese Arbeit sowohl für den Autoren wie auch dessen Arbeitgeber die Chance, verschiedene moderne Analysetechniken/ -methoden an Finanzdaten anzuwenden, welche auch für andere Projekte wertvoll sein können.



